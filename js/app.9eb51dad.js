(function(t){function e(e){for(var r,i,s=e[0],c=e[1],u=e[2],l=0,p=[];l<s.length;l++)i=s[l],a[i]&&p.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);f&&f(e);while(p.length)p.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(r=!1)}r&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var r={},a={app:0},o=[];function i(t){return s.p+"js/"+({about:"about"}[t]||t)+"."+{about:"27bb6793"}[t]+".js"}function s(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(t){var e=[],n=a[t];if(0!==n)if(n)e.push(n[2]);else{var r=new Promise(function(e,r){n=a[t]=[e,r]});e.push(n[2]=r);var o,c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=i(t),o=function(e){c.onerror=c.onload=null,clearTimeout(u);var n=a[t];if(0!==n){if(n){var r=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src,i=new Error("Loading chunk "+t+" failed.\n("+r+": "+o+")");i.type=r,i.request=o,n[1](i)}a[t]=void 0}};var u=setTimeout(function(){o({type:"timeout",target:c})},12e4);c.onerror=c.onload=o,document.head.appendChild(c)}return Promise.all(e)},s.m=t,s.c=r,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(n,r,function(e){return t[e]}.bind(null,r));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/mc2413/",s.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var f=u;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var r=n("64a9"),a=n.n(r);a.a},"21bb":function(t,e,n){"use strict";var r=n("bcc9"),a=n.n(r);a.a},5556:function(t,e,n){"use strict";var r=n("7c30"),a=n.n(r);a.a},"56d7":function(t,e,n){"use strict";n.r(e);n("744f"),n("6c7b"),n("7514"),n("20d6"),n("1c4c"),n("6762"),n("cadf"),n("e804"),n("55dd"),n("d04f"),n("c8ce"),n("217b"),n("7f7f"),n("f400"),n("7f25"),n("536b"),n("d9ab"),n("f9ab"),n("32d7"),n("25c9"),n("9f3c"),n("042e"),n("c7c6"),n("f4ff"),n("049f"),n("7872"),n("a69f"),n("0b21"),n("6c1a"),n("c7c62"),n("84b4"),n("c5f6"),n("2e37"),n("fca0"),n("7cdf"),n("ee1d"),n("b1b1"),n("87f3"),n("9278"),n("5df2"),n("04ff"),n("f751"),n("4504"),n("fee7"),n("ffc1"),n("0d6d"),n("9986"),n("8e6e"),n("25db"),n("e4f7"),n("b9a1"),n("64d5"),n("9aea"),n("db97"),n("66c8"),n("57f0"),n("165b"),n("456d"),n("cf6a"),n("fd24"),n("8615"),n("551c"),n("097d"),n("df1b"),n("2397"),n("88ca"),n("ba16"),n("d185"),n("ebde"),n("2d34"),n("f6b3"),n("2251"),n("c698"),n("a19f"),n("9253"),n("9275"),n("3b2b"),n("3846"),n("4917"),n("a481"),n("28a5"),n("386d"),n("6b54"),n("4f7f"),n("8a81"),n("ac4d"),n("8449"),n("9c86"),n("fa83"),n("48c0"),n("a032"),n("aef6"),n("d263"),n("6c37"),n("9ec8"),n("5695"),n("2fdb"),n("d0b0"),n("5df3"),n("b54a"),n("f576"),n("ed50"),n("788d"),n("14b9"),n("f386"),n("f559"),n("1448"),n("673e"),n("242a"),n("c66f"),n("b05c"),n("34ef"),n("6aa2"),n("15ac"),n("af56"),n("b6e4"),n("9c29"),n("63d9"),n("4dda"),n("10ad"),n("c02b"),n("4795"),n("130f"),n("ac6a"),n("96cf"),n("0cdd");var r=n("2b0e"),a=n("5f5b");n("6cef"),n("2dd8");r["default"].use(a["a"]);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("div",[n("b-navbar",{staticClass:"mb-2",attrs:{type:"dark",variant:"dark"}},[n("b-navbar-brand",[t._v("MC2413")]),n("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[n("b-navbar-nav",[n("b-nav-item",{attrs:{to:"/"}},[t._v("Home")]),n("b-nav-item",{attrs:{to:"/about"}},[t._v("About")])],1)],1)],1)],1),n("b-container",[n("router-view")],1)],1)},i=[],s=n("8cc4"),c=n.n(s),u=n("2ef0"),l=n.n(u);function f(t){return f="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}function m(t,e){return!e||"object"!==f(e)&&"function"!==typeof e?g(t):e}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}function y(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}function v(t,e){return v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},v(t,e)}function w(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=function(t){function e(t){var n;p(this,e),n=m(this,b(e).call(this)),n.params={};var r=n.getParamNames();return l.a.forIn(r,function(t,e){t.forEach(function(t){n.setParam(e,t.name,t.default)})}),n}return y(e,t),d(e,[{key:"getName",value:function(){return"base"}},{key:"getParamNames",value:function(){return{}}},{key:"setParams",value:function(t){var e=this,n=this.getParamNames();l.a.forIn(t.params,function(t,r){t.forEach(function(t,a){e.setParam(r,n[r][a].name,t.value)})})}},{key:"setParam",value:function(t,e,n){return n}}]),e}(t);return e}var _=w;function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function x(t,e,n){return e&&k(t.prototype,e),n&&k(t,n),t}function C(t){return C="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){return!e||"object"!==C(e)&&"function"!==typeof e?T(t):e}function T(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},q(t)}function S(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}function E(t,e){return E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},E(t,e)}var j=function(t){function e(){return O(this,e),P(this,q(e).call(this,{type:"sine",frequency:440,detune:0,phase:0,partials:[],partialCount:0}))}return S(e,t),e}(c.a.Oscillator),M=function(t){function e(t){var n;return O(this,e),n=P(this,q(e).call(this,{})),n._writable(["oscillator","frequency","detune","envelope"]),n.oscillator=new j,n.oscillator.chain(n.envelope,n.output),n.frequency=n.oscillator.frequency,n.detune=n.oscillator.detune,n.connect(t),n}return S(e,t),x(e,[{key:"getName",value:function(){return"2a03"}},{key:"getParamNames",value:function(){return{wv:[{name:"soundwave",type:"select",options:["sqrt","sine","tri","noise"],default:"sqrt"},{name:"tune",type:"number",max:127,default:0},{name:"fine",type:"number",max:127,default:0}]}}},{key:"setParam",value:function(t,e,n){"wv"==t&&"soundwave"==e&&("sqrt"==n?this.oscillator.type="square":"tri"==n&&(this.oscillator.type="triangle"))}}]),e}(_(c.a.Synth)),N=M;function L(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function z(t,e,n){return e&&L(t.prototype,e),n&&L(t,n),t}function A(t,e,n){return A="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=$(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(n):a.value}},A(t,e,n||t)}function $(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=X(t),null===t)break;return t}function D(t){return D="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function I(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){return!e||"object"!==D(e)&&"function"!==typeof e?F(t):e}function F(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function X(t){return X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},X(t)}function W(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}function G(t,e){return G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},G(t,e)}c.a.OscillatorNode;var R=function(t){function e(){return I(this,e),B(this,X(e).call(this,{type:"sine",frequency:440,detune:0,phase:0,partials:[],partialCount:0}))}return W(e,t),z(e,[{key:"createNode",value:function(){var t=this,e=4096;this.scriptNode=this.context.createScriptProcessor(e);var n=0,r=this.context.sampleRate;this.scriptNode.onaudioprocess=function(a){a.inputBuffer.getChannelData(0);for(var o=a.outputBuffer.getChannelData(0),i=a.outputBuffer.getChannelData(1),s=t._oscillator.now()+4096/r,c=0;c<e;++c){var u=r/t.frequency.getValueAtTime(s+e/r),l=2*n/u;o[c]=i[c]=l-1,n++,n>=u&&(n=0)}}.bind(this),this.scriptNode.connect(this.output)}},{key:"_start",value:function(t){A(X(e.prototype),"_start",this).call(this,t),this.createNode(),this._oscillator.connect(this.scriptNode),this._oscillator.disconnect(this.output)}}]),e}(c.a.Oscillator),H=function(t){function e(t){var n;return I(this,e),n=B(this,X(e).call(this,{})),n._writable(["oscillator","frequency","detune","envelope"]),n.oscillator=new R,n.oscillator.chain(n.envelope,n.output),n.frequency=n.oscillator.frequency,n.detune=n.oscillator.detune,n.connect(t),n}return W(e,t),z(e,[{key:"getName",value:function(){return"experimental"}},{key:"getParamNames",value:function(){return{wv:[{name:"soundwave",type:"select",options:["sqrt","sine","tri","noise"],default:"sqrt"},{name:"tune",type:"number",max:127,default:0},{name:"fine",type:"number",max:127,default:0}]}}},{key:"setParam",value:function(t,e,n){"wv"==t&&"soundwave"==e&&("sqrt"==n?this.oscillator.type="square":"tri"==n&&(this.oscillator.type="triangle"))}}]),e}(_(c.a.Synth)),K=H;function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function U(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function V(t,e,n){return e&&U(t.prototype,e),n&&U(t,n),t}var J=function(){function t(){Y(this,t),this.clearChannel(),this.masterChannel=new c.a.Channel({volume:-10}).toMaster(),this.SynthTypes={"2a03":N,experimental:K},this.synthParams={}}return V(t,[{key:"createChannel",value:function(t,e){e&&this.SynthTypes[e]||(e="2a03");var n=new this.SynthTypes[e](this.masterChannel);this.channel[t]=n}},{key:"clearChannel",value:function(){l.a.forIn(this.channel,function(t){return t.dispose()}),this.channel={}}},{key:"getChannel",value:function(t){return this.channel[t]}},{key:"noteOn",value:function(t,e,n,r){return this.getChannel(r).triggerAttack(this.normalizeInterval(t),n,e)}},{key:"noteChange",value:function(t,e,n){return this.getChannel(n).setNote(this.normalizeInterval(t),e)}},{key:"noteOff",value:function(t,e){return this.getChannel(e).triggerRelease(t)}},{key:"noteOnOff",value:function(t,e,n,r,a){return this.getChannel(a).triggerAttackRelease(this.normalizeInterval(t),e,n,r)}},{key:"registerSynthParams",value:function(t){this.synthParams=t}},{key:"setSynthParams",value:function(t,e){var n=this.getChannel(t),r=this.synthParams[e];n.setParams(r)}},{key:"connectStore",value:function(t){var e=this,n=null;t.subscribe(function(t,n){switch(t.type){case"engine/updateTrackType":e.clearChannel(),l.a.forIn(t.payload,function(t,n){e.createChannel(n,t)});break;case"engine/updateTone":e.registerSynthParams(t.payload);break}}),t.subscribeAction(function(t,r){var a=t.type,o=t.payload;switch(a){case"engine/noteOnTestTone":n!=o&&(null===n?e.noteOn(o,.5,void 0,"a"):e.noteChange(o)),n=o;break;case"engine/noteOffTestTone":e.noteOff(void 0,"a"),n=null;break;case"engine/selectNote":e.noteOnOff(o.interval,.25,void 0,o.velocity,o.tr);break;default:break}}.bind(this))}},{key:"normalizeInterval",value:function(t){var e={"A+":"A#","A-":"G#","B+":"C","B-":"A#","C+":"C#","C-":"B","D+":"D#","D-":"C#","E+":"F","E-":"D#","F+":"F#","F-":"E","G+":"G#","G-":"F#"},n=t.toUpperCase().match(/([A-G][#+-]*)(\d+)/);if(!n)return"";var r=n[1],a=n[2];return e[n[1]]&&(r=e[n[1]]),"C-"==n[1]&&a--,"B+"==n[1]&&a++,r+a}}]),t}(),Q=J;function Z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function et(t,e,n){return e&&tt(t.prototype,e),n&&tt(t,n),t}window.Tone=c.a;var nt=c.a.Transport,rt=function(t,e){return c.a.Time(192*t+(e||0),"i")},at=function(){function t(e){Z(this,t),this.controller=e,nt.PPQ=192,nt.loop=!1,this.part={}}return et(t,[{key:"connectStore",value:function(t){var e=this;this.store=t,t.subscribeAction(function(t,n){var r=t.type;t.payload;switch(r){case"engine/playSequence":"started"==nt.state&&nt.stop(0),e.storeEvent(n),c.a.context.latencyHint="playback",nt.start();break;case"engine/stopSequence":nt.stop(),c.a.context.latencyHint="interactive";break}})}},{key:"storeEvent",value:function(t){var e=this;nt.cancel(),this.indicator=new c.a.Loop(function(t){c.a.Draw.schedule(function(){var t=c.a.Time(nt.position).toTicks()/192-c.a.Time(c.a.context.lookAhead+c.a.context.baseLatency).toTicks()/192;e.store.dispatch("engine/tickSequence",t>0?t:0)},t)}.bind(this),.05).start(),t.engine.tempo&&(nt.bpm.value=t.engine.tempo),l.a.forIn(t.engine.sequence,this.processTrack.bind(this))}},{key:"processTrack",value:function(t,e){var n=this,r=new c.a.Part(this.processEvent.bind(this),l.a.map(t,function(t){return[rt(t.time),t]})).start();r.loopEnd=1/0,t.filter(function(t){return"bpm"==t.type}).forEach(function(t){nt.schedule(function(e){nt.bpm.value=t.bpm},rt(t.time))}),t.filter(function(t){return"runtime_loop"===t.type}).forEach(function(t){r.loop=0===t.count||t.count,nt.schedule(function(e){r.loopStart=rt(t.start),r.loopEnd=rt(t.end)},rt(t.time,1))}),t.filter(function(t){return"set_tone"===t.type}).forEach(function(t){var e=n.controller;nt.schedule(function(n){e.setSynthParams(t.tr,t.tone)},rt(t.time))}),t.filter(function(t){return"note"==t.type||"pitch"==t.type}).forEach(function(t){var e=t.time-2;e>2&&c.a.Draw.schedule(function(){n.store.dispatch("engine/beforeNoteOn",t)},rt(e))})}},{key:"processEvent",value:function(t,e){var n=this;switch(e.type){case"note":case"pitch":this.controller.noteOnOff(e.interval,rt(e.duration),t,e.velocity,e.tr),c.a.Draw.schedule(function(){n.store.dispatch("engine/noteOn",e)},t),c.a.Draw.schedule(function(){n.store.dispatch("engine/noteOff",e)},c.a.Time(c.a.Time(t).toTicks()+192*e.duration,"i"));break}}}]),t}(),ot=function(){function t(){Z(this,t),this.controller=new Q,this.sequencer=new at(this.controller)}return et(t,[{key:"connectStore",value:function(t){this.controller.connectStore(t),this.sequencer.connectStore(t)}}]),t}(),it=ot,st='// FF3 Theme\n\n//define\n#track a-c 2a03\n\n@1:2a03{\n  wv: "sqrt"\n}\n\n@3:2a03{\n  wv: "tri"\n}\n\n\n// Intro\nt t136 L1\na o5L4v15@1\nb o4L8v11@1\nc o3L2v13@3\n\nt rrrr\na g+d+ef+ g2f+e e1 d+2...r16\nb b2g4ab> c4<b4a4g4 f+2ef+ga b4f+ga4d+4\nc ec <a>d< b>f+ b<b>>\n\nt rrrr\na c2e2 d+2^8.r16<b> e2g2 f+2...r16\nb e4ede4g4 f+4f+ef+2 >c4<cdef+gab4f+4d+4<b4>\nc L8 c4<cdef+ga brf+rd+r<br> erede4c4 f+rf+ef+2\n\nt rrr t126 r4 t118 r4 t112 r4 t96 r4\na e2g2 f+2^8.r16d+4 a2>c2< bag+f+\nb g2e4g4 <b4b>c+d+2 e4f+4g4e4 d+4c+4<b4a4\nc cdef+g4f+e d+ef+ga4b4> L2 c<a f+<b\n\n// Theme\n\nt t144\na o4L4v15\nb o3L4v11\nc o3L2v13\n\nabc [\n\na b>ef+<b> a2g+f+ ed+8e8f+ee2d+2 c+f+g+c+ b2ag+ f+f8g+8f+c+ g+2f+2<\nb b2.>c+8d+8ec+d+f+ c+d+8e8f+g+8a+8 bf+d+<b> f+2ff+8g+8 af+fb a2a+2 b2a2<\nc ed+ c+<b aa+ b1> ag+ f+f f+e d+<b>\n\na b>ef+<b> a2g+f+ ed+8e8f+ee2d+2 c+f+g+c+ b2ag+ f+f8g+8f+c+ g+2f+f+16g+16a16b16>\nb b2.>c+8d+8ec+d+f+ c+d+8e8f+g+8a+8 bf+d+<b> f+2ff+8g+8 af+fb a2a+2 b2a2\nc ed+ c+c c+<a+ b1> ag+ f+f f+e d+<b>\n\n//a >>\n//b >\n//c\n\n// a c+2.^-8r8c+< b2.^-8r8g+ aa8g+8f+f f+g+ab>\na c+2^8r8c+< b2^8r8g+ aa8g+8f+f f+g+ab>\nb L8 e4ag+a4e4 e4bag+f+eg+> d<af+4g+c+d+f f+4<b>c+def+4\nc L8 ar<ab>c+d+ef+ g+rg+f+g+rer f+4d4c+4bg+ f+4e4d4c+4<\n\na d2^8r8d c+2^8r8<a bb8>c8<bb8>c8< bag+f+<\nb g2^gab a2^agf+ e4edcde4 d+2e4f+4<\nc br>babrgr f+r>c+r<ar<ab> cr>cr<ef+g4 f+4d+4<b4a4>\n\nb L4\nc L2\n\nabc ]0\n',ct=new it,ut={name:"app",mounted:function(){ct.connectStore(this.$store),this.$store.dispatch("engine/changeMML",st)}},lt=ut,ft=(n("034f"),n("2877")),pt=Object(ft["a"])(lt,o,i,!1,null,null,null),ht=pt.exports,dt=n("8c4f"),mt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("b-row",{staticClass:"mb-2 pianoroll-control"},[n("b-col",{attrs:{sm:"2"}},[n("b-button",{staticClass:"float-left",attrs:{disabled:""}},[t._v("scale:"+t._s(Number(t.pianoroll_scale).toFixed(2)))])],1),n("b-col",{attrs:{sm:"6"}},[n("b-form-input",{attrs:{type:"range",min:"0.5",max:"4",step:"0.25",variant:"secondary"},model:{value:t.pianoroll_scale,callback:function(e){t.pianoroll_scale=t._n(e)},expression:"pianoroll_scale"}})],1),n("b-col",{attrs:{sm:"3"}},[n("b-dropdown",{staticClass:"float-right",attrs:{text:"grid:"+t.pianoroll_quantize}},t._l(t.pianoroll_quantize_options,function(e){return n("b-dropdown-item",{key:e,on:{click:function(n){t.pianoroll_quantize=e}}},[t._v(t._s(e))])}),1)],1)],1),n("piano-roll",{staticClass:"piano-roll mb-2",attrs:{scale:t.pianoroll_scale,quantize:t.pianoroll_quantize}}),n("b-row",{staticClass:"mb-2 tranport"},[n("b-col",{attrs:{sm:"12"}},[n("b-button-group",{attrs:{size:"sm"}},[n("b-button",{attrs:{variant:"success"},on:{click:t.playTransport}},[t._v("Play")]),n("b-button",{on:{click:t.stopTransport}},[t._v("Stop")]),n("b-button",{attrs:{disabled:""}},[t.transportPlaying?n("b-spinner",{attrs:{small:"",type:"grow"}}):t._e(),t._v("\n          "+t._s(t.transportPositionBars)+"\n        ")],1)],1)],1)],1),n("mml-editor")],1)},gt=[],bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("codemirror",{ref:"cm",attrs:{value:t.mml,options:t.cmOptions}}),t.mmlError?n("b-alert",{staticClass:"mt-4",attrs:{show:"",variant:"danger"}},[t._v("\n    "+t._s(t.mmlError.message)+"\n  ")]):t._e()],1)},yt=[],vt=n("2f62"),wt=n("8f94"),_t=(n("a7be"),n("91e8"),n("31c5"),n("9948"),n("8822"),n("0dd0"),n("56b3")),kt=n.n(_t);function xt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ct(t,e,n[e])})}return t}function Ct(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}kt.a.defineMode("mml",function(){return{startState:function(t){return{ctx:null}},token:function(t,e){if(0==t.column()){if(null===e.ctx&&t.match(/^\s*[a-z0-9]+/))return e.ctx="track","qualifier";if(t.match(/^\s*@.+?:.+/))return e.ctx="define_tone","variable"}if("define_tone"==e.ctx){if(t.match(/".+?"/))return"string";if(t.match(/.+?:/))return"keyword";if(t.match(","))return"operator";if(t.match("{"))return"bracket";if(t.match("}"))return e.ctx=null,"bracket"}else if("track"==e.ctx){if(t.match(/[a-gr][+#-]*/i))return"operator";if(t.match(/[\d^.&]+/))return"number";if(t.match(/[><tlvqo]/i))return"keyword"}return t.match(/\/\/.*/)?"comment":(t.next(),null)},indent:function(t,e){if("define_tone"==t.ctx&&"}"!=e)return 2}}});var Ot=null;kt.a.registerHelper("lint","mml",function(t,e){var n=Ot;if(n){var r=new kt.a.Pos(n.start.line-1,n.start.column-1),a=new kt.a.Pos(n.end.line-1,n.end.column-1);return[{from:r,to:a,message:n.message}]}return[]});var Pt={name:"mml-editor",components:{codemirror:wt["codemirror"]},data:function(){return{cmOptions:{mode:"mml",theme:"mmleditor",lineNumbers:!0,line:!0,lineWrapping:!0,styleActiveLine:!0,styleSelectedText:!0,lint:!0,gutters:["CodeMirror-lint-markers"]},selections:{}}},computed:xt({codemirror:function(){return this.$refs.cm.codemirror}},Object(vt["c"])("engine",{mml:"mml",mmlError:"mmlError"})),mounted:function(){var t=this,e=this.codemirror;this.initCodeMirror(e),this.$store.subscribe(function(t,e){"engine/updateMmlError"==t.type&&(Ot=t.payload)}),this.$store.subscribeAction(function(n,r){var a,o,i=n.payload;switch(n.type){case"engine/playSequence":case"engine/stopSequence":l.a.forIn(t.selections,function(t){return t.clear()}),t.selections={};break;case"engine/selectNote":case"engine/noteOn":t.changeCursorByProc=!0,a=new kt.a.Pos(i.start.line-1,i.start.column-1),o=new kt.a.Pos(i.end.line-1,i.end.column-1),"engine/selectNote"==n.type&&(e.focus(),e.setCursor(a)),t.selections[i.tr]&&t.selections[i.tr].clear(),t.selections[i.tr]=e.markText(a,o,{className:"flush"});break;case"engine/noteOff":t.selections[i.tr]&&t.selections[i.tr].clear();break}}.bind(this))},methods:{initCodeMirror:function(t){var e=this;t.on("change",function(t,n){e.$store.dispatch("engine/changeMML",t.getValue())}),t.on("cursorActivity",function(t){if(e.changeCursorByProc)e.changeCursorByProc=!1;else{var n=t.getCursor();e.$store.dispatch("engine/changeCursorMML",{line:n.line+1,column:n.ch+1})}})}}},Tt=Pt,qt=(n("cb7f"),Object(ft["a"])(Tt,bt,yt,!1,null,null,null)),St=qt.exports,Et=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"wrapper",attrs:{ondragstart:"return false;",ondrop:"return false;"}},[n("svg",[n("defs",[n("pattern",{attrs:{id:"ptn-grid",width:t.quantize_width*t.quantize,height:"112",patternUnits:"userSpaceOnUse",patternContentUnits:"userSpaceOnUse",x:32+t.grid_offset}},t._l(t.util.range(t.quantize),function(e){return n("g",{key:e,attrs:{transform:t.getTransform(e*t.quantize_width,0)}},[n("rect",{staticClass:"a",attrs:{y:"0",width:t.quantize_width,height:"112"}}),n("rect",{staticClass:"b",attrs:{y:"10",width:t.quantize_width,height:"9"}}),n("rect",{staticClass:"b",attrs:{y:"28",width:t.quantize_width,height:"9"}}),n("rect",{staticClass:"b",attrs:{y:"46",width:t.quantize_width,height:"9"}}),n("rect",{staticClass:"b",attrs:{y:"74",width:t.quantize_width,height:"10"}}),n("rect",{staticClass:"b",attrs:{y:"94",width:t.quantize_width,height:"9"}}),n("line",{class:t.getLineClass(e,t.quantize),attrs:{x1:"0",y1:"0",x2:"0",y2:"112"}}),n("line",{staticClass:"d",attrs:{x1:"0",y1:"0",x2:t.quantize_width,y2:"0"}}),n("line",{staticClass:"c",attrs:{x1:"0",y1:"64",x2:t.quantize_width,y2:"64"}})])}),0)]),n("g",{ref:"stage",staticClass:"trans",attrs:{transform:t.getTransform(0,-1*t.stage_pos.y,t.scale)}},[n("rect",{attrs:{x:"32",width:t.stage_width,height:112*t.octaves,fill:"url(#ptn-grid)"},on:{mousedown:function(e){return t.onDrag("start",e)},mouseup:function(e){return t.onDrag("end",e)},mousemove:function(e){return t.onDrag("move",e)},wheel:function(e){return e.preventDefault(),t.onDrag("wheel",e)}}}),n("g",{ref:"note",staticClass:"note-container",attrs:{transform:t.getTransform(-1*t.stage_pos.x,0)}},t._l(t.note,function(e){return n("g",{key:e.id,attrs:{transform:t.getTransform(t.getXfromTime(e.time)+32,t.getYfromNote(e.interval))},on:{click:function(n){return t.onClickNote(n,e)}}},[n("rect",{staticClass:"note",attrs:{width:t.getXfromTime(e.duration),height:t.getHeightfromNote(e.interval),fill:t.getNoteColor(e,e.selected),stroke:t.getNoteColor(e,!0)}}),t.scale>=2?n("text",{attrs:{transform:"translate(2 6.5)"}},[t._v("\n            "+t._s(t.getNoteName(e.interval))+"\n          ")]):t._e()])}),0),t.cursorX?n("rect",{ref:"cursor",staticClass:"cursor trans",attrs:{transform:t.getTransform(-1*t.stage_pos.x,0),x:t.cursorX+32,width:Math.max(2,4/t.scale),height:112*t.octaves}}):t._e(),n("g",{ref:"piano",attrs:{id:"piano"}},t._l(t.util.range(t.octaves),function(e){return n("g",{key:"key-"+e,attrs:{transform:t.getTransform(0,112*(9-e)),"data-octave":e},on:{mousedown:function(e){return t.onKeyboard("down",e)},mousemove:function(e){return t.onKeyboard("move",e)},mouseup:function(e){return t.onKeyboard("up",e)},mouseout:function(e){return t.onKeyboard("out",e)}}},[n("rect",{staticClass:"a",attrs:{y:"96",width:"32",height:"16","data-note":"c"}}),n("rect",{staticClass:"a",attrs:{y:"80",width:"32",height:"16","data-note":"d"}}),n("rect",{staticClass:"a",attrs:{y:"64",width:"32",height:"16","data-note":"e"}}),n("rect",{staticClass:"a",attrs:{y:"48",width:"32",height:"16","data-note":"f"}}),n("rect",{staticClass:"a",attrs:{y:"32",width:"32",height:"16","data-note":"g"}}),n("rect",{staticClass:"a",attrs:{y:"16",width:"32",height:"16","data-note":"a"}}),n("rect",{staticClass:"a",attrs:{y:"0",width:"32",height:"16","data-note":"b"}}),n("rect",{staticClass:"b",attrs:{y:"94",width:"20",height:"8","data-note":"c#"}}),n("rect",{staticClass:"b",attrs:{y:"74",width:"20",height:"8","data-note":"d#"}}),n("rect",{staticClass:"b",attrs:{y:"46",width:"20",height:"8","data-note":"f#"}}),n("rect",{staticClass:"b",attrs:{y:"28",width:"20",height:"8","data-note":"g#"}}),n("rect",{staticClass:"b",attrs:{y:"10",width:"20",height:"8","data-note":"a#"}}),n("text",{staticClass:"c",attrs:{transform:"translate(22 108)"}},[t._v("C"+t._s(e))])])}),0)])])])},jt=[],Mt=n("6929"),Nt=n.n(Mt);function Lt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){zt(t,e,n[e])})}return t}function zt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var At={C:{y:103,height:9},D:{y:84,height:10},E:{y:64,height:10},F:{y:55,height:9},G:{y:37,height:9},A:{y:19,height:9},B:{y:0,height:10},"C#":{y:94,height:9},"D#":{y:74,height:10},"F#":{y:46,height:9},"G#":{y:28,height:9},"A#":{y:10,height:9}},$t="#2283e5",Dt="#855181",It="#e42222",Bt={name:"piano-roll",props:{scale:{type:Number,default:2},quantize:{type:Number,default:8},x:{type:Number,default:0},y:{type:String,default:"b4"}},data:function(){return{util:l.a,octaves:10,stage_pos:{x:0,y:0},stage_width:1e4,last_pos:null,selection:null,cursorX:null}},mounted:function(){var t=this;window.addEventListener("resize",this.updateStageWidth),this.updateStageWidth(),this.setStagePos(this.x*this.scale,this.getYfromNote(this.y)*this.scale),this.$store.subscribeAction(function(e,n){if("engine/tickSequence"==e.type){var r=e.payload,a=t.getXfromTime(r);t.cursorX=a;var o=t.stage_width/2;(a>t.stage_pos.x+o||a<t.stage_pos.x)&&t.setStagePos(a-o,t.stage_pos.y)}if("engine/beforeNoteOn"==e.type){var i=e.payload;t.setCenterInterval(i.interval)}if("engine/noteOn"==e.type){var s=e.payload;t.flushKeyboard(!0,s)}if("engine/noteOff"==e.type){var c=e.payload;t.flushKeyboard(!1,c,100)}if("engine/changeCursorMML"==e.type){var u=e.payload,l=null;t.note.some(function(t){if(t.start.line==u.line&&t.start.column<=u.column&&t.end.column>u.column)return l=t,!0}),l&&(t.setCenterInterval(l.interval,l.time),t.cursorX=t.getXfromTime(l.time))}})},beforeDestroy:function(){window.removeEventListener("resize",this.updateStageWidth)},computed:Lt({quantize_width:function(){return 256/this.quantize},grid_offset:function(){return this.stage_pos.x%(this.quantize_width*this.quantize)*-1}},Object(vt["b"])("engine",{note:"noteSequence"})),watch:{scale:function(t,e){this.stage_pos.x*=t/e,this.stage_pos.y*=t/e,this.updateStageWidth()}},methods:{getTransform:function(t,e,n){var r="";return null!==t&&null!==e&&(r+="translate(".concat(t,",").concat(e,")")),n&&(r+=" scale(".concat(n,")")),r},getLineClass:function(t,e){return 0==t?"measure":t%(e/4)==0?"beat":"tick"},onDrag:function(t,e){switch(t){case"start":this.last_pos={x:e.offsetX,y:e.offsetY},this.$refs.stage.classList.remove("trans");break;case"move":e.buttons||(this.last_pos=null),null!==this.last_pos&&(this.setStagePos(this.stage_pos.x+(this.last_pos.x-e.offsetX)/this.scale,this.stage_pos.y+(this.last_pos.y-e.offsetY)/this.scale),this.last_pos={x:e.offsetX,y:e.offsetY});break;case"end":this.last_pos=null,this.$refs.stage.classList.add("trans");break;case"wheel":this.setStagePos(this.stage_pos.x,this.stage_pos.y+e.deltaY/2/this.scale);break}},onKeyboard:function(t,e){var n=e.target.dataset.note+e.target.parentNode.dataset.octave;switch(t){case"down":this.$store.dispatch("engine/noteOnTestTone",n);break;case"up":this.$store.dispatch("engine/noteOffTestTone");break;case"move":e.buttons&&this.$store.dispatch("engine/noteOnTestTone",n);break;case"out":this.$store.dispatch("engine/noteOffTestTone");break}},updateStageWidth:function(){this.stage_width=this.$refs.wrapper.offsetWidth/this.scale},setStagePos:function(t,e){this.stage_pos.x=Math.max(0,t),this.stage_pos.y=Math.min(Math.max(0,e),1120*this.scale-this.$refs.wrapper.offsetHeight)},normalizeNote:function(t){var e={"A+":"A#","A-":"G#","B+":"C","B-":"A#","C+":"C#","C-":"B","D+":"D#","D-":"C#","E#":"F","E+":"F","E-":"D#","F+":"F#","F-":"E","G+":"G#","G-":"F#"},n=t.toUpperCase().match(/([A-G][#+-]*)(\d+)/);if(!n)return null;var r=n[1];return e[n[1]]&&(r=e[n[1]]),{name:r,org_name:n[1].toUpperCase(),octave:n[2]}},getNoteName:function(t){var e=this.normalizeNote(t);return e?e.org_name:""},getYfromNote:function(t){var e=this.normalizeNote(t);return e?112*(9-e.octave)+At[e.name].y:0},getHeightfromNote:function(t){var e=this.normalizeNote(t);return At[e.name].height},getXfromTime:function(t){return 16*t*4},getNoteColor:function(t,e){var n,r=t.velocity;return r>.5?(n=Nt()(Dt),n=n.mix(Nt()(It),2*(r-.5))):(n=Nt()($t),n=n.mix(Nt()(Dt),2*r)),e?n.lighten(.5).rgb().string():n.rgb().string()},flushKeyboard:function(t,e,n){var r=this.normalizeNote(e.interval),a=r.name.toLowerCase(),o=r.octave,i=this.$refs.piano.querySelector('g[data-octave="'.concat(o,'"] rect[data-note="').concat(a,'"]'));if(i){var s=function(){t?i.classList.add("active"):i.classList.remove("active")};n?l.a.delay(s,n):s()}},onClickNote:function(t,e){this.selection&&this.$set(this.selection,"selected",!1),this.$set(e,"selected",!0),this.setCenterInterval(e.interval,e.time),this.cursorX=this.getXfromTime(e.time),this.selection=e,this.$store.dispatch("engine/selectNote",e)},setCenterInterval:function(t,e){var n=this.getYfromNote(t)*this.scale,r=this.getXfromTime(e)-this.$refs.wrapper.offsetWidth/2/this.scale;r<0&&(r=0);var a=null;n<this.stage_pos.y&&(a="up"),n>this.stage_pos.y+this.$refs.wrapper.offsetHeight&&(a="down"),(a||r!=this.stage_pos.x)&&this.setStagePos(e?r:this.stage_pos.x,a?"up"==a?n:n-this.$refs.wrapper.offsetHeight:this.stage_pos.y)}}},Ft=Bt,Xt=(n("5556"),Object(ft["a"])(Ft,Et,jt,!1,null,null,null)),Wt=Xt.exports;n("a8bf");function Gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Rt(t,e,n[e])})}return t}function Rt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ht={name:"home",components:{MmlEditor:St,PianoRoll:Wt},data:function(){return{pianoroll_scale:1,pianoroll_quantize:16,pianoroll_quantize_options:[32,24,16,12,9,8,4,3,2,1],transportPosition:0}},computed:Gt({transportPositionBars:function(){var t=l.a.padStart(Math.floor(this.transportPosition/4),3,"0"),e=Math.floor(this.transportPosition%4),n=l.a.padStart(Math.floor(this.transportPosition%1*16),2,"0");return"".concat(t,":").concat(e,":").concat(n)}},Object(vt["c"])("engine",{transportPlaying:"transportPlaying"})),mounted:function(){var t=this;this.$store.subscribeAction(function(e,n){"engine/tickSequence"==e.type&&(t.transportPosition=e.payload)})},methods:{playTransport:function(){this.$store.dispatch("engine/playSequence")},stopTransport:function(){this.$store.dispatch("engine/stopSequence")}}},Kt=Ht,Yt=(n("21bb"),Object(ft["a"])(Kt,mt,gt,!1,null,null,null)),Ut=Yt.exports;r["default"].use(dt["a"]);var Vt=new dt["a"]({routes:[{path:"/",name:"home",component:Ut},{path:"/about",name:"about",component:function(){return n.e("about").then(n.bind(null,"f820"))}}]}),Jt=n("ce47"),Qt=n.n(Jt);function Zt(t){if(t.name&&"empty"==t.name)return!0;if(t.value){var e=t.value;if(e.hasOwnProperty("length")&&0==e.length)return!0}return!t}function te(t){var e={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};return t.replace(/\\(u[0-9a-fA-F]{4}|[^u])/,function(t,n){var r=n.charAt(0),a=n.slice(1);return"u"===r?String.fromCharCode(parseInt(a,16)):e.hasOwnProperty(r)?e[r]:r})}var ee=Qt.a.regexp(/[ \t]*/).node("empty").desc("whitespace"),ne=Qt.a.regexp(/[ \t]+/).node("empty").desc("whitespace"),re=Qt.a.regexp(/\d+/).map(function(t){return parseInt(t)}),ae=Qt.a.regexp(/"((?:\\.|.)*?)"/,1).map(te).desc("string"),oe=Qt.a.regexp(/[a-z0-9_-]+/i).map(function(t){return t.toLowerCase()}),ie=Qt.a.of("").node("empty"),se=Qt.a.regexp(/\s*\/\/.*/).node("empty").desc("comment"),ce=Qt.a.createLanguage({interval:function(t){return Qt.a.regexp(/[a-g][#+-]?/i).map(function(t){return t.toLowerCase()}).node("interval").desc("note")},rest:function(t){return Qt.a.regexp(/r/i).node("rest").desc("R")},length:function(t){return Qt.a.alt(re,Qt.a.regexp(/[.^+\-\\]/)).many().node("length").desc("length")},slur:function(t){return Qt.a.string("&").node("slur")},withLength:function(t){return Qt.a.seq(Qt.a.alt(t.interval,t.rest),t.length.or(ie).skip(ee),t.slur.or(ie).skip(ee))},setLength:function(t){return Qt.a.seq(Qt.a.alt(Qt.a.regexp(/l/i).map(function(t){return t.toLowerCase()}).node("length_set").desc("L")),t.length)},withAmount:function(t){return Qt.a.seq(Qt.a.alt(Qt.a.regexp(/o/i).node("octave_set").desc("O"),Qt.a.regexp(/q/i).node("quantize_set").desc("Q"),Qt.a.regexp(/t/i).node("bpm_set").desc("T"),Qt.a.regexp(/v/i).node("velocity_set").desc("V")),re.node("amount")).desc("number")},command:function(t){return Qt.a.alt(Qt.a.string(">").node("octave_shift"),Qt.a.string("<").node("octave_shift"))},loop_start:function(t){return Qt.a.string("[").node("loop_start")},loop_branch:function(t){return Qt.a.string("|").node("loop_branch")},loop_end:function(t){return Qt.a.seqMap(Qt.a.string("]"),re.or(ie),function(t,e){return"empty"==e.name?2:e}).node("loop_end")},setTone:function(t){return Qt.a.seqMap(Qt.a.string("@"),Qt.a.alt(re,Qt.a.seqMap(Qt.a.string("`"),oe,Qt.a.string("`"),function(t,e,n){return e})).desc("name"),function(t,e){return e}).node("set_tone").desc("@0 or @`a`")},mml:function(t){return Qt.a.alt(t.withLength,t.setLength,t.withAmount,t.command,t.loop_start,t.loop_branch,t.loop_end,t.setTone,se).skip(ee).many().map(function(t){return t.flat().filter(function(t){return!Zt(t)})})}}),ue=Qt.a.seqMap(Qt.a.regexp(/[a-z0-9]/i),Qt.a.seqMap(Qt.a.string("-"),Qt.a.regexp(/[a-z0-9]/i),function(t,e){return e}).or(ie),function(t,e){if(Zt(e))return[t.toLowerCase()];var n=t.toLowerCase(),r=e.toLowerCase(),a=n.charCodeAt(0),o=r.charCodeAt(0),i="a".charCodeAt(0),s="z".charCodeAt(0),c="0".charCodeAt(0),u="9".charCodeAt(0);return a>=i&&a<=s&&o>=i&&o<=s?l.a.range(a,o+1).map(function(t){return String.fromCharCode(t)}):a>=c&&a<=u&&o>=c&&o<=u?l.a.range(a,o+1).map(function(t){return String.fromCharCode(t)}):[n,r]}).many().map(function(t){return l.a.flatten(t)}).desc("trackName"),le=Qt.a.seqMap(ue,ne,ce.mml,function(t,e,n){return{target:t,mml:n}}).trim(ee).node("track").desc("track"),fe=Qt.a.createLanguage({whitespace:function(t){return Qt.a.alt(Qt.a.whitespace,se).many()},optWhitespace:function(t){return Qt.a.alt(t.whitespace,ie)},value:function(t){return Qt.a.seqMap(oe.map(function(t){return t.toLowerCase()}).trim(ee).desc("key"),Qt.a.string(":"),Qt.a.alt(re,ae,Qt.a.of("")).trim(t.optWhitespace).node("define_tone_value").sepBy(Qt.a.string(",")),function(t,e,n){return[t,n]})},toneName:function(t){return Qt.a.alt(re,Qt.a.seqMap(Qt.a.string("`"),oe,Qt.a.string("`"),function(t,e,n){return e}))},tone:function(t){return Qt.a.seqMap(Qt.a.string("@"),t.toneName.desc("name"),Qt.a.string(":").trim(t.optWhitespace),oe.desc("type"),t.optWhitespace,Qt.a.string("{"),t.value.many().trim(t.optWhitespace),Qt.a.string("}"),se.or(ie),function(t,e,n,r,a,o,i,s){return{name:e,type:r,params:l.a.zipObject(i.map(function(t){return t[0]}),i.map(function(t){return t[1]}))}}).trim(ee).node("define_tone")}}),pe=Qt.a.createLanguage({track:function(t){return Qt.a.seqMap(Qt.a.string("track"),ne,ue,ne,oe,function(t,e,n,r,a){return{target:n,type:a}}).node("define_track")},tempo:function(t){return Qt.a.seqMap(Qt.a.string("tempo"),ne,re,function(t,e,n){return n}).node("define_tempo")},define:function(t){return Qt.a.seqMap(Qt.a.string("#"),Qt.a.alt(t.tempo,t.track),se.or(ie),function(t,e,n){return e}).trim(ee)}}),he=Qt.a.alt(se,le,fe.tone,pe.define,ie).sepBy(Qt.a.newline).map(function(t){return t.filter(function(t){return!Zt(t)})}),de=he;function me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ge(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function be(t,e,n){return e&&ge(t.prototype,e),n&&ge(t,n),t}var ye=function(t,e,n){var r=new SyntaxError(t);throw r.start=l.a.clone(e),r.end=n?l.a.clone(n):{line:e.line,column:e.column+1},r},ve=function(t,e,n){return Math.max(t,Math.min(e,n))},we=function(){function t(e){me(this,t),this.token=e,this.index=0}return be(t,[{key:"hasNext",value:function(){return this.index<this.token.length}},{key:"peek",value:function(){return this.token[this.index]||null}},{key:"prev",value:function(){return this.index>0&&this.token[this.index-1]||null}},{key:"next",value:function(){return this.token[this.index++]}},{key:"match",value:function(t){var e=this.peek();return e&&e.name===t}},{key:"expect",value:function(t){var e=this.peek();if(e&&e.name==t)return this.next();ye("compile error: Expected ".concat(t),e.start,e.end)}},{key:"setIndex",value:function(t){this.index=t}},{key:"getIndex",value:function(){return this.index}}]),t}(),_e=function(){function t(){me(this,t),this.defaultParams={octave:4,length:1,velocity:8/15,quantize:1},this.tempo=null,this.clear()}return be(t,[{key:"clear",value:function(){this.index=1,this.tracks={},this.tones={}}},{key:"getTrack",value:function(t){return this.tracks[t]?this.tracks[t]:this.createTrack(t)}},{key:"createTrack",value:function(t){return this.tracks[t]=l.a.merge({time:0,type:null,data:[],name:t},this.defaultParams),this.tracks[t]}},{key:"getData",value:function(){return l.a.mapValues(this.tracks,function(t){return t.data})}},{key:"getTone",value:function(){return this.tones}},{key:"getTrackType",value:function(){return l.a.mapValues(this.tracks,function(t){return t.type})}},{key:"compile",value:function(t){var e=this;this.clear();var n=de.parse(t);if(!1===n.status){var r=n.expected.join(" or ");ye("parse error: expected ".concat(r),{line:n.index.line,column:n.index.column},{line:n.index.line,column:t.split(/\n/)[n.index.line-1].length+1})}var a={};return n.value.forEach(function(t){if("track"==t.name)t.value.target.forEach(function(n){e.getTrack(n);a[n]||(a[n]=[]),Array.prototype.push.apply(a[n],t.value.mml)});else if("define_tone"==t.name){var n=t.value;e.tones[n.name]=l.a.merge({start:t.start,end:t.end},n)}else if("define_track"==t.name){var r=t.value;r.target.forEach(function(t){var n=e.getTrack(t);n.type=r.type})}else"define_tempo"==t.name&&(e.tempo=t.value)}),l.a.forIn(this.tracks,function(t,n){a[n]&&e.compileMml(t,a[n])}),this.getData()}},{key:"compileMml",value:function(t,e){var n=this,r=!1,a=function(t,e){return t*e},o=function(e){var n=e.value,r=0,a=null,o=1;return n.forEach(function(e,i){switch(e){case 0:break;case"+":case"^":case"\\":case"-":null===a?(r+=t.length*o,a=t.length):a=null,o="+"==e||"^"==e?1:-1,i==n.length-1&&(r+=t.length*o);break;case".":null===a&&(r+=t.length*o,a=t.length),a/=2,r+=a*o;break;default:a=4/e,r+=a*o;break}}),r<=0&&ye("compile error: Invalid length",e.start,e.end),r},i=function(e){t.data.push(l.a.merge({id:n.index++,tr:t.name},e))},s=new we(e),c=[];while(s.hasNext()){var u=s,f=u.next(),p=void 0,h=void 0;switch(f.name){case"interval":p=u.match("length")?o(u.next()):t.length,i({type:r?"pitch":"note",interval:String(f.value)+String(t.octave),time:t.time,duration:u.match("slur")?p:a(p,t.quantize),velocity:t.velocity,start:f.start,end:u.prev().end}),t.time+=p,r=!1;break;case"rest":p=u.match("length")?o(u.next()):t.length,t.time+=p;break;case"octave_set":t.octave=ve(0,9,u.expect("amount").value);break;case"octave_shift":t.octave+=">"==f.value?1:-1,t.octave=ve(0,8,t.octave);break;case"length_set":t.length=o(u.expect("length"));break;case"velocity_set":t.velocity=ve(0,1,u.expect("amount").value/15);break;case"quantize_set":t.quantize=ve(0,1,u.expect("amount").value/8);break;case"slur":r=!0;break;case"bpm_set":i({type:"bpm",time:t.time,bpm:ve(1,600,u.expect("amount").value),start:f.start,end:u.prev().end});break;case"loop_start":c.push({index:u.getIndex(),count:null,time:t.time});break;case"loop_branch":h=c[c.length-1],1===h.count&&(c.pop(),u.setIndex(h.endIndex));break;case"loop_end":0==c.length&&ye('compileError: missing "["',f.start,f.end),h=c[c.length-1],null===h.count&&(0===f.value&&i({type:"runtime_loop",count:f.value,time:h.time,start:h.time,end:t.time}),h.count=f.value,h.endIndex=u.getIndex()),h.count--,h.count>0?u.setIndex(h.index):c.pop();break;case"set_tone":i({type:"set_tone",tone:f.value,time:t.time});break;default:break}}}}]),t}(),ke=new _e,xe={namespaced:!0,state:{mml:"",mmlError:null,trackType:{},tone:{},tempo:120,sequence:[],transportPlaying:!1},getters:{noteSequence:function(t){return l.a.flatten(l.a.map(t.sequence,function(t){return t.filter(function(t){return"note"==t.type||"pitch"==t.type})}))}},mutations:{updateSequence:function(t,e){t.sequence=e},updateTrackType:function(t,e){t.trackType=e},updateTone:function(t,e){t.tone=e},updateTempo:function(t,e){t.tempo=e},updateMml:function(t,e){t.mml=e},updateMmlError:function(t,e){t.mmlError=e},updateTransportPlaying:function(t,e){t.transportPlaying=e}},actions:{noteOnTestTone:function(t,e){},noteOffTestTone:function(t){},changeMML:function(t,e){t.commit("updateMml",e);try{t.commit("updateSequence",ke.compile(e)),t.commit("updateTrackType",ke.getTrackType()),t.commit("updateTone",ke.getTone()),t.commit("updateTempo",ke.tempo),t.commit("updateMmlError",null)}catch(n){console.error(n),t.dispatch("errorMML",n)}},changeCursorMML:function(t,e){},errorMML:function(t,e){t.commit("updateMmlError",e)},changePianoRoll:function(t,e){t.commit("updateSequence",e)},playSequence:function(t){t.commit("updateTransportPlaying",!0)},stopSequence:function(t){t.commit("updateTransportPlaying",!1)},tickSequence:function(t,e){},beforeNoteOn:function(t,e){},noteOn:function(t,e){},noteOff:function(t,e){},selectNote:function(t,e){}}};r["default"].use(vt["a"]);var Ce=new vt["a"].Store({modules:{engine:xe}});r["default"].config.productionTip=!1,new r["default"]({router:Vt,store:Ce,render:function(t){return t(ht)}}).$mount("#app")},"64a9":function(t,e,n){},"6cef":function(t,e,n){},"7c30":function(t,e,n){},"91e8":function(t,e,n){},bcc9:function(t,e,n){},cb7f:function(t,e,n){"use strict";var r=n("d316"),a=n.n(r);a.a},d316:function(t,e,n){}});
//# sourceMappingURL=app.9eb51dad.js.map